{% load npda_tags %}
<div class="flex flex-col gap-4" id="pt_level_report">
  <div class="flex gap-4">


    {% include 'dashboard/pt_level_menu_tab_button.html' with selected=highlight.health_checks key='health_checks' button_text='Health Checks' %}
    {% include 'dashboard/pt_level_menu_tab_button.html' with selected=highlight.additional_care_processes key='additional_care_processes' button_text='Additional Care Processes' %}
    {% include 'dashboard/pt_level_menu_tab_button.html' with selected=highlight.care_at_diagnosis key='care_at_diagnosis' button_text='Care at Diagnosis' %}
    {% include 'dashboard/pt_level_menu_tab_button.html' with selected=highlight.outcomes key='outcomes' button_text='Outcomes' %}
    {% include 'dashboard/pt_level_menu_tab_button.html' with selected=highlight.treatment key='treatment' button_text='Treatment' %}

  </div>
  <!-- CURRENT SELECTION DESCRIPTION -->
  <div class="flex flex-col">
    <p>
      {{ text.description }}
    </p>
  </div>

  <div class="flex">
    <table class="table-auto w-full text-sm text-left text-gray-500 mb-5 font-montserrat overflow-x-auto">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 bg-rcpch_dark_blue text-white">
        <tr>
          {% comment %} TODO: ONCE ALL DATA ADDED, REMOVE THIS CHECK {% endcomment %}
          {% if text.headers %}
            {% for header in text.headers %}
            <th class="px-6 py-4">{{ header }}</th>
            {% endfor %}
          {% else %}
            <th>Not implemented</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>

        {% if row_data %}
          {% for pt_pk, results in row_data.pts_results.items %}
            <tr class="bg-white border-b">
              {% for kpi_attr_name in row_data.kpi_attr_names %}
                <td class="px-6 py-4">
                  {% with result=results|get_item:kpi_attr_name %}
                    {% if kpi_attr_name == 'nhs_number'%}
                    <span class="tooltip tooltip-right" data-tip="View patient details (opens new tab)">
                      <a class="btn hover:text-rcpch_pink" target="_blank" href="{% url 'patient-update' pt_pk %}">
                        {{ results|get_item:kpi_attr_name }}
                      </a>
                    </span>
                    {% elif  result is True   %}
                    ✔️
                    {% elif result is False %}
                    ✖️
                    {% else %}
                    N/A
                    {% endif %}
                  {% endwith %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        {% else %}
          <tr class="bg-white border-b">
            <td class="px-6 py-4" colspan="10">No data available</td>
          </tr>
        {% endif %}

        <tr class="bg-white border-b">
          <td class="px-6 py-4">
            <span class="tooltip tooltip-right" data-tip="View patient details (opens new tab)">
              <a class="btn hover:text-rcpch_pink" target="_blank" href="{% url 'patient-update' 123 %}">
                {{ patient.nhs_number }}
              </a>
            </span>
          </td>
          <td class="px-6 py-4">{{ kpi_calculations_object.gte_12yo|yesno:"Y,N" }}</td>
          <td class="px-6 py-4">
            {% if kpi_calculations_object.kpi_results.kpi_25_hba1c %}
            ✔️
            {% else %}
            ✖️
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {% if kpi_calculations_object.kpi_results.kpi_26_bmi %}
            ✔️
            {% else %}
            ✖️
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {% if kpi_calculations_object.kpi_results.kpi_27_thyroid_screen %}
            ✔️
            {% else %}
            ✖️
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {% if kpi_calculations_object.kpi_results.kpi_28_blood_pressure is not None %}
            {% if kpi_calculations_object.kpi_results.kpi_28_blood_pressure %}
            ✔️
            {% else %}
            ✖️
            {% endif %}
            {% else %}
            N/A
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {% if kpi_calculations_object.kpi_results.kpi_29_urinary_albumin is not None %}
            {% if kpi_calculations_object.kpi_results.kpi_29_urinary_albumin %}
            ✔️
            {% else %}
            ✖️
            {% endif %}
            {% else %}
            N/A
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {% if kpi_calculations_object.kpi_results.kpi_30_retinal_screening is not None %}
            {% if kpi_calculations_object.kpi_results.kpi_30_retinal_screening %}
            ✔️
            {% else %}
            ✖️
            {% endif %}
            {% else %}
            N/A
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {% if kpi_calculations_object.kpi_results.kpi_31_foot_examination is not None %}
            {% if kpi_calculations_object.kpi_results.kpi_31_foot_examination %}
            ✔️
            {% else %}
            ✖️
            {% endif %}
            {% else %}
            N/A
            {% endif %}
          </td>
          <td class="px-6 py-4">
            {{ kpi_calculations_object.total_passed }}/{{ kpi_calculations_object.expected_total }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
