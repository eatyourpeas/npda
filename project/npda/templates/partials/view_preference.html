{% load static %}
<div class="flex flex-wrap md:flex-nowrap justify-normal" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    <div class="order-1 inline-flex flex-grow justify-center items-center text-center text-nowrap pl-4 p-2 font-semibold text-sm bg-rcpch_light_blue text-white">
        Selected Paediatric Diabetes Unit:
    </div>

    <div class="order-2 inline-flex  justify-center flex-grow  items-center text-center p-2 font-semibold text-sm bg-gray-300 text-white font-mono">
        <span class="font-mono bg-gray-500 p-1 text-nowrap">
            {% if view_preference == 1 %}
                {{ chosen_pdu }} only
            {% elif view_preference == 2 %}
                National (all)
            {% else %}
                UnknownViewPreference
            {% endif %}
        </span>
    </div>

    <span class="loading loading-spinner loading-lg text-rcpch_pink htmx-indicator" id="spinner"></span>

    
    
    {% if view_preference == 1 %}
    <!-- Select Input -->
        <select 
            id="pz_code_select_name" 
            name="pz_code_select_name" 
            class="order-last md:order-3 select rcpch-select rounded-none text-xs  flex-grow " 
            hx-post="{% url 'view_preference' %}" 
            hx-target="#global_view_preference" 
            hx-trigger="change" 
            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'  
            hx-include="[name='view_preference'], [name='pz_code_select_name']"
        >
            {% for pdu_choice in pdu_choices %}
                <option value="{{ pdu_choice.0 }}" {% if chosen_pdu == pdu_choice.0 %} selected="{{ chosen_pdu }}" {% endif %}>
                    {{ pdu_choice.1 }}
                </option>
            {% endfor %}
        </select>

        {% if request.user.is_superuser or request.user.is_rcpch_audit_team_member or request.user.is_rcpch_staff %}
            <!-- Remove Filter Button -->
            <label for="view_preference_2" class="order-3   flex-grow  md:order-last btn bg-rcpch_pink hover:bg-rcpch_pink_light_tint1 text-white font-montserrat focus:bg-rcpch_pink_light_tint1 text-xs">
                <i class="fa-solid fa-filter-circle-xmark"></i>
                Remove PDU filter
                <input 
                    id="view_preference_2"
                    hx-post="{% url 'view_preference' %}" 
                    hx-target="#global_view_preference" 
                    hx-trigger="click" 
                    hx-swap="innerHTML" 
                    class="hidden" 
                    type="radio" 
                    name="view_preference" 
                    value="2" 
                    {% if view_preference == 2 %} checked {% endif %} 
                    hx-include="[name='view_preference'], [name='pz_code_select_name']"
                />
            </label>
        {% endif %}
    {% elif view_preference == 2 %}
        <!-- Apply Filter Button -->
        <label for="view_preference_1" class="order-3  flex-grow  md:order-last btn bg-rcpch_pink hover:bg-rcpch_pink_light_tint1 text-white font-montserrat focus:bg-rcpch_pink_light_tint1 text-xs">
            <input 
                id="view_preference_1"
                hx-post="{% url 'view_preference' %}" 
                hx-target="#global_view_preference" 
                hx-trigger="click" 
                hx-swap="innerHTML" 
                class="hidden"
                type="radio" 
                name="view_preference" 
                value="1" 
                {% if view_preference == 2 %} checked {% endif %} 
                hx-include="[name='view_preference'], [name='pz_code_select_name']"
            />
            <i class="fa-solid fa-filter"></i>
            Apply a PDU filter
        </label>
    {% else %}
        UnknownViewPreference
    {% endif %}
</div>
