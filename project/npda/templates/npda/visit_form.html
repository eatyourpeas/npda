{% extends 'base.html' %}
{% load npda_tags %}
{% csrf_token %}
{% block content %}
  <div class="flex justify-center bg-white py-8">
    <div class="max-w-full lg:max-w-[75%] px-2 bg-white font-montserrat">
      <strong>
        {{ title }} - NHS Number {{ nhs_number }}
      </strong>
      <form id="update-form"
            method="post"
            {% if form_method == "create" %} action="{% url 'visit-create' patient_id %}" {% else %} action="{% url 'visit-update' patient_id=patient_id pk=visit.pk %}" {% endif %}>
        {% csrf_token %}
        {% for field in form %}
          {% if field.field.category is None %}
            <!-- visit date box -->
            <div class="md:flex md:items-center mb-6 mt-2 {% if background_colour %}bg-{{ background_colour }}{% endif %}">
              <div class="md:w-1/3">
                <label for="{{ field.id_for_label }}"
                       class="block text-gray-700 font-bold md:text-right mb-1 md:mb-0 pr-4">
                  <small>{{ field.label }}</small>
                </label>
              </div>
              <div class="flex space-between md:w-2/3">
                {% if field.id_for_label == "id_visit_date" %}
                  <input type="date" id="{{ field.id_for_label }}" name="{{ field.html_name }}" class="input rcpch-input-text {% if not can_alter_this_audit_year_submission or not can_complete_questionnaire %}opacity-40 pointer-events-none{% endif %}" {% if field.value %}value={{ field.value|stringformat:'s' }}{% endif %}>
                  <button type='button'
                          _="on click set #{{ field.id_for_label }}'s value to '{% today_date %}'"
                          class="btn rcpch-btn bg-rcpch_light_blue border border-rcpch_light_blue hover:bg-rcpch_strong_blue hover:border-rcpch_strong_blue {% if not can_alter_this_audit_year_submission or not can_complete_questionnaire %}opacity-40 pointer-events-none{% endif %}">
                    Today
                  </button>
                {% endif %}
                {% for error in field.errors %}
                  <p>
                    <strong class="text-gray-700">{{ error|escape }}</strong>
                  </p>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
        <div role="tablist" class="flex flex-wrap">
          {% for tab, categories in visit_tabs %}
            {% include 'partials/visit_form_tab.html' with checked="true" label=tab categories=categories %}
          {% endfor %}
        </div>
        <div class="flex justify-end">
          <button type="submit"
                  value="Submit"
                  class="btn rcpch-btn bg-rcpch_light_blue border border-rcpch_light_blue hover:bg-rcpch_strong_blue hover:border-rcpch_strong_blue {% if not can_alter_this_audit_year_submission or not can_complete_questionnaire %}opacity-40 pointer-events-none{% endif %}">
            {{ button_title }}
          </button>
          <a class="btn rcpch-btn bg-rcpch_yellow_light_tint1 border border-rcpch_yellow_light_tint1 hover:bg-rcpch_yellow hover:border-rcpch_yellow"
             href="{% url 'patient_visits' patient_id=patient_id %}">Cancel</a>
          {% if form_method == 'update' and perms.npda.delete_visit %}
            <a class="btn rcpch-btn bg-rcpch_red text-white font-semibold hover:text-white py-2.5 px-3 border border-rcpch_red hover:bg-rcpch_red_dark_tint hover:border-rcpch_red_dark_tint {% if not can_alter_this_audit_year_submission or not can_complete_questionnaire %}opacity-40 pointer-events-none{% endif %}"
               href="{% url 'visit-delete' patient_id visit.pk %}">Delete</a>
          {% endif %}
        </div>
      </form>
    </div>
  </div>
{% endblock %}
